<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basicLayout}">

<th:block layout:fragment="script">
  <script th:inline="javascript">
    let message = [[${message}]];
    if(message != null) alert(message);

    document.addEventListener("DOMContentLoaded", function() {
      document.getElementById("profileImage").onclick = function() {
          document.getElementById("sFile").click();
      };
    });

    function previewImage(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
          document.getElementById('profileImage').src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    function fCheck() {
      let fName = document.getElementById("sFile").value;
      let maxSize = 1024 * 1024 * 10;
      let ext = fName.substring(fName.lastIndexOf(".")+1).toLowerCase();

      if(fName.trim() == "") {
        alert("업로드할 파일을 선택하세요");
        return false;
      }

      let fileSize = document.getElementById("sFile").files[0].size;
      if(fileSize > maxSize) {
        alert("업로드할 파일의 최대용량은 10MByte 입니다.");
      }

      else if(ext != 'jpg' && ext != 'gif' && ext != 'png') {
        alert("업로드 가능한 파일은 'jpg, gif, png '만 가능합니다.")
      }
      else {
        if(confirm("프로필 사진을 변경하시겠습니까?")) {
          uploadForm.submit();
        }
        else {
          return false;
        }
      }
    }
  </script>
</th:block>
<th:block layout:fragment="css">
  <style>
    /* 프로필 이미지 */
    .profile-image {
      width: 160px;
      height: 160px;
      border-radius: 12px;
      border: 3px solid #a8c9ff;
      object-fit: cover;
      background: #f0f4ff;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }

    /* 정보 카드 공통 스타일 */
    .info-card {
      background: rgba(203, 228, 252, 0.45); /* 파스텔 톤 */
      border-radius: 12px;
      padding: 20px 22px;
      border: 1px solid #d2e4ff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      transition: 0.25s ease;
      text-align: center;

      /* 두 카드 높이 동일하게 */
      min-height: 160px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* hover 효과 */
    .info-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }

    /* info 제목 */
    .info-card h5 {
      font-weight: 700;
      color: #1d4f89;
      font-size: 19px;
      margin-bottom: 14px;
      letter-spacing: 0.5px;
    }

    /* info 텍스트 */
    .info-card div {
      margin-bottom: 8px;
      font-size: 15.5px;
      color: #1e2a3a;
      font-weight: 500;
      line-height: 1.55;
      letter-spacing: 0.2px;
    }

    /* 선택/저장 버튼 */
    .btn-primary.btn-sm,
    .btn-success.btn-sm {
      padding: 6px 14px;
      font-size: 13px;
      border-radius: 6px;
      font-weight: 600;
    }

    /* 버튼 크기統一 */
    .d-flex.gap-2 button,
    .d-flex.gap-2 label {
      min-width: 70px;
    }
  </style>
</th:block>
<div layout:fragment="content">
<!--  <img src="/SpringGroupBB/images/title.png" style="width: 100%; height: 112px;">-->
  <div class="device-card">
    <h2>내 정보</h2>
  </div>
  <div  class="device-card">
    <div class="row mt-4">
      <div class="col-md-6 d-flex flex-column align-items-center mb-3">
        <form th:action="@{/member/updateProfileImage}" method="post" name="uploadForm" enctype="multipart/form-data" class="text-center mb-3">
          <img th:src="${member.profileImage != 'noImage.jpg'} ? @{'/member/profile/'+${member.profileImage}} : @{/images/noimage.jpg}"
            id="profileImage" alt="프로필 이미지" class="profile-image mb-2">
          <div class="d-flex gap-2 justify-content-center">
            <label for="sFile" class="btn btn-primary btn-sm">사진 선택</label>
            <input type="file" id="sFile" name="sFile" class="d-none" accept="image/*" onchange="previewImage(event)">
            <button type="button" onclick="fCheck()" class="btn btn-success btn-sm">저장</button>
          </div>
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>
      </div>
      <div class="col-md-6 mb-3 d-flex">
        <div class="info-card flex-fill text-center">
          <h5>기본 정보</h5>
          <div>이름 : [[${member.name}]]</div>
          <div>이메일 : [[${member.email}]]</div>
          <div>휴대폰 : [[${member.tel}]]</div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="info-card flex-fill text-center ">
          <h5>계정 정보</h5>
          <div>회원 등급 : <span th:text="${member.role.korean} + ' (' + ${member.role.name} + ')'">관리자 (ADMIN)</span></div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="info-card h-100">
          <h5>활동 정보</h5>
          <div>
            내가 쓴 글 수 :
            <a th:href="@{/board/boardList(search='name', searchString=${member.name})}" class="text-decoration-none">
              <span th:text="${boardCnt} + '건'">0건</span>
            </a>
          </div>
          <div>
            댓글 수 :
            <span th:text="${boardReplyCnt} + '건'">0건</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</html>