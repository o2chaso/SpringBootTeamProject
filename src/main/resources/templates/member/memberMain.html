<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basicLayout}">

<th:block layout:fragment="script">
  <script th:inline="javascript">
    let message = [[${message}]];
    if(message != null) alert(message);

    function previewImage(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
          document.getElementById('profileImage').src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    function fCheck() {
      let fName = document.getElementById("sFile").value;
      let maxSize = 1024 * 1024 * 10;
      let ext = fName.substring(fName.lastIndexOf(".")+1).toLowerCase();

      if(fName.trim() == "") {
        alert("업로드할 파일을 선택하세요");
        return false;
      }

      let fileSize = document.getElementById("sFile").files[0].size;
      if(fileSize > maxSize) {
        alert("업로드할 파일의 최대용량은 10MByte 입니다.");
      }

      else if(ext != 'jpg' && ext != 'gif' && ext != 'png') {
        alert("업로드 가능한 파일은 'jpg, gif, png '만 가능합니다.")
      }
      else {
        if(confirm("프로필 사진을 변경하시겠습니까?")) {
          uploadForm.submit();
        }
        else {
          return false;
        }
      }
    }
  </script>

</th:block>

<th:block layout:fragment="css">
  <style>
    .profile-container {
        text-align: center;
        margin-top: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .profile-image {
        width: 300px;
        height: 300px;
<!--        border-radius: 50%;-->
        object-fit: cover;
        cursor: pointer;
    }
    .profile-image:hover {
        opacity: 0.7;
    }
    .file-input {
        display: none; /* 기본적으로 숨기기 */
    }
    .change-photo-btn {
      margin-top: 15px;
      background-color: #007bff;
      color: white;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
      border: none;
    }
    .profile-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
    }

    .profile-info div {
      margin: 10px 0;
      font-size: 16px;
    }

    .profile-info .label {
      font-weight: bold;
    }
  </style>

</th:block>
  <div layout:fragment="content">
    <h2>내 정보</h2>
    <div class="row">
      <div class="col-md-6 d-flex flex-column align-items-center mb-4 mb-md-0">
        <form th:action="@{/member/updateProfileImage}"
              method="post" name="uploadForm"
              enctype="multipart/form-data" class="w-100 text-center">
          <img th:src="${member.profileImage != 'noImage.jpg'} ? @{'/member/profile/'+${member.profileImage}} :
                        @{/images/noImage.jpg}" id="profileImage" alt="프로필 이미지" class="img-fluid rounded mb-3"
                        style="max-width: 300px; height: 300px; object-fit: cover;">
          <div class="d-flex gap-2 justify-content-center">
            <label for="sFile" class="btn btn-primary">사진 선택</label>
            <input type="file" id="sFile" name="sFile" class="d-none" accept="image/*" onchange="previewImage(event)" />
            <button type="button" onclick="fCheck()" class="btn btn-success">저장하기</button>
          </div>
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>
      </div>
      <div class="col-6 d-flex flex-column justify-content-center">
        <div>
          <div><span class="mb-2">이름:</span> [[${member.name}]]</div>
          <div><span>이메일:</span> [[${member.email}]]</div>
        </div>
        <div>
          <div>내가 쓴 글 수 : </div>
          <div></div>
        </div>
      </div>
    </div>
  </div>
</html>
