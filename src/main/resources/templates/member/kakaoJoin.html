<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basicLayout}">

<th:block layout:fragment="script">
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script th:src="@{/js/woo.js}"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script th:inline="javascript">
    let message = [[${message}]];
    if(message != null) alert(message);

    function fCheck() {
      let tel1 = form.tel1.value;
      let tel2 = form.tel2.value.trim();
      let tel3 = form.tel3.value.trim();
      let tel = tel1 + "-" + tel2 + "-" + tel3;

      let postcode = form.postcode.value + " ";
      let roadAddress = form.roadAddress.value + " ";
      let detailAddress = form.detailAddress.value + " ";
      let extraAddress = form.extraAddress.value + " ";
      let address = postcode + "/" + roadAddress + "/" + detailAddress + "/" + extraAddress;

      let birthday = form.birthday.value;
      let birthdayMax = form.birthday.max;

      form.tel.value = tel;
      form.address.value = address;

      if(birthday != '') {
        if(birthday > birthdayMax) {
          alert("오늘 이후 날짜는 선택할 수 없습니다.");
          $("#birthday").val(birthdayMax);
          return false;
        }
      }

      form.submit();
    }

  </script>
</th:block>

<style layout:fragment="css" >
  body {
    font-family: Arial, sans-serif;
  }
  .row {
    margin: 0px;
    padding: 10px;
    align-items: center;
  }
  .row label {
    width: 120px;
    text-align: right;
    margin-right: 10px;
  }
</style>

<div layout:fragment="content">
  <div  class="device-card">
    <h2>카카오 회원가입</h2>
    <div class="row">
      <div class="col text-end"><span class="essential">*</span>필수</div>
    </div>
    <form name="form" method="post" th:object="${memberDTO}" class="flex-grow-1">
      <div class="row align-items-center justify-content-center">
        <label th:for="email" class="col-auto col-form-label">이메일<span class="essential">*</span></label>
        <div class="col-md-4">
          <input type="email" id="email" th:field="*{email}" class="form-control" readonly>
        </div>
      </div>
      <div class="row">
        <div class="col-md-5 text-start">
          <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}"
               class="fieldError text-danger small mt-1">
          </div>
        </div>
      </div>
      <div class="row align-items-center justify-content-center">
        <label th:for="password" class="col-auto col-form-label">비밀번호<span class="essential">*</span></label>
        <div class="col-md-4">
          <input type="password" id="password" th:field="*{password}" class="form-control" placeholder="비밀번호를 입력해주세요"/>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-md-5 text-start">
          <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}"
               class="fieldError text-danger small mt-1">
          </div>
        </div>
      </div>
      <div class="row align-items-center justify-content-center">
        <label th:for="name" class="col-auto col-form-label">이름<span class="essential">*</span></label>
        <div class="col-md-4">
          <input type="text" th:field="*{name}" class="form-control" readonly/>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-md-5 text-start">
          <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}"
               class="fieldError text-danger small mt-1">
          </div>
        </div>
      </div>
      <div class="row align-items-center justify-content-center">
        <label class="col-auto col-form-label">전화번호<span class="essential">*</span></label>
        <div class="col-md-4 d-flex">
          <select name="tel1" class="form-select me-1">
            <option value="010" selected>010</option>
            <option value="011">011</option>
            <option value="016">016</option>
            <option value="017">017</option>
            <option value="018">018</option>
            <option value="019">019</option>
          </select>
          <span class="pt-1 ms-1 me-1">-</span>
          <input type="tel" th:field="*{tel2}" class="form-control ms-1 me-1"/>
          <span class="pt-1 ms-1 me-1">-</span>
          <input type="tel" th:field="*{tel3}" class="form-control ms-1 me-1"/>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-md-5 text-start">
          <div th:if="${#fields.hasErrors('tel')}" th:errors="*{tel}"
               class="fieldError text-danger small mt-1">
          </div>
        </div>
      </div>
      <div class="row align-items-start justify-content-center">
        <label class="col-form-label col-2 pb-5 pt-5">주소</label>
        <div class="col-md-4">
          <div class="input-group mb-2">
            <input type="text" name="postcode" id="sample6_postcode" placeholder="우편번호" readOnly class="form-control">
            <input type="button" onclick="sample6_execDaumPostcode()" value="우편번호 찾기" class="btn btn-secondary btn-sm">
          </div>
          <div class="mb-1"><input type="text" name="roadAddress" id="sample6_address" size="50" placeholder="주소" readOnly
                                   class="form-control mb-1"></div>
          <div class="input-group">
            <input type="text" name="detailAddress" id="sample6_detailAddress" placeholder="상세주소"
                   class="form-control me-2">
            <input type="text" name="extraAddress" id="sample6_extraAddress" placeholder="참고항목" class="form-control">
          </div>
        </div>
      </div>
      <div class="row align-items-center justify-content-center">
        <label class="col-auto col-form-label">생일</label>
        <div class="col-md-4">
          <input type="date" id="birthday" th:field="*{birthday}" class="form-control"
                  th:max="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"/>
        </div>
      </div>
      <div class="d-flex justify-content-center gap-3 mt-4">
        <button type="button" class="btn btn-dark w-40 px-4" onclick="fCheck()">회원가입</button>
        <button type="button" id="kakaoLogoutBtn" class="btn btn-dark w-40 px-4"
                onclick="location.href='/SpringGroupBB/member/kakaoLogout'">취소</button>
      </div>
      <input type="hidden" th:field="*{tel}"/>
      <input type="hidden" th:field="*{address}"/>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </form>
  </div>
</div>
</html>